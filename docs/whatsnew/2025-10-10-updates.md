---
title: "AntGent v0.11.0: Streamlined Configuration and Improved Developer Experience"
date: 2025-10-10
tags: [release, features, configuration, agents]
---

# AntGent v0.11.0: Streamlined Configuration and Improved Developer Experience

We're excited to announce AntGent v0.11.0, a release focused on reducing boilerplate code and making multi-provider AI workflows easier to build and maintain. This update introduces three major features that simplify common development patterns while maintaining full backwards compatibility.

## ğŸ¯ What's New

### 1. Centralized Model Provider Configuration

**The Problem:**
When building workflows that use multiple LLM providers (OpenAI, Gemini, Anthropic, etc.), you previously had to specify `client` and `api_mode` settings for every agent configuration. This led to repetitive code and made it difficult to manage provider-specific settings centrally:

```python
# Before: Manual configuration everywhere
summary_agent_conf = AgentConfig(
    model="gpt-4o",
    client="openai",      # Repeated in every workflow
    api_mode="response"   # Repeated in every workflow
)

gemini_agent_conf = AgentConfig(
    model="gemini/gemini-pro",
    client="litellm",     # More repetition
    api_mode="chat"       # More repetition
)
```

**The Solution:**
We've introduced a new `model_providers` configuration section that maps model name prefixes to their required client and API mode settings. Configure once, use everywhere:

```yaml
# localconfig.yaml
model_providers:
  default:
    client: "litellm"
    api_mode: "chat"
  mappings:
    - prefix: "gpt-"
      client: "openai"
      api_mode: "response"
    - prefix: "openai/"
      client: "openai"
      api_mode: "response"
    - prefix: "gemini/"
      client: "litellm"
      api_mode: "chat"
    - prefix: "anthropic/"
      client: "litellm"
      api_mode: "chat"
```

Now your agent configurations become much cleaner:

```python
# After: Just specify the model
agent_conf = AgentConfig(
    model="gpt-4o"
    # client and api_mode automatically resolved to "openai" and "response"
)
```

**How It Works:**

When an agent is initialized or reconfigured, `BaseAgent` automatically resolves the `client` and `api_mode` based on this precedence order:

1. **Explicit agent configuration** (highest priority)
2. **Prefix matching** from `model_providers.mappings`
3. **Default provider settings** from `model_providers.default`

| Model Name | Matched Prefix | Applied `client` | Applied `api_mode` |
|------------|----------------|------------------|-------------------|
| `gpt-4o` | `gpt-` | `openai` | `response` |
| `gpt-3.5-turbo` | `gpt-` | `openai` | `response` |
| `openai/gpt-4` | `openai/` | `openai` | `response` |
| `gemini/gemini-pro` | `gemini/` | `litellm` | `chat` |
| `anthropic/claude-3` | *(no match)* | `litellm` *(default)* | `chat` *(default)* |

**Dynamic Model Switching:**

This feature really shines when you need to switch models at runtime:

```python
# In a workflow activity
async def run_analysis(ctx: AnalysisContext):
    agent_config = AgentConfig(model=ctx.model_name)
    # Provider settings automatically applied based on model_name
    agent = AnalysisAgent(conf=agent_config)
    return await agent.workflow(llm_input="", context=ctx)
```

**Explicit Overrides Still Work:**

Need to override the automatic resolution? No problem:

```yaml
agents:
  SpecialAgent:
    model: "gpt-4o"
    client: "litellm"  # Explicitly override the "openai" from prefix matching
    # api_mode will still be "response" from the gpt- prefix
```

**Migration Guide:**

This feature is **fully backwards compatible**. Your existing configurations will continue to work without any changes. However, we recommend:

1. **Audit your configurations**: Identify repeated `client` and `api_mode` settings
2. **Move to `model_providers`**: Consolidate provider settings into the new section
3. **Clean up agent configs**: Remove redundant `client` and `api_mode` from individual agents
4. **Test**: Verify your workflows with the simplified configuration

---

### 2. Automatic Empty Message Filtering

**The Problem:**
Empty or whitespace-only messages in LLM inputs can cause API errors, waste tokens, and make debugging difficult. Previously, developers had to manually filter these out in every agent's `prep_input` method.

**The Solution:**
We've added automatic empty message filtering directly into `BaseAgent.run_result()`. Now empty messages are caught and removed before they reach the LLM, with helpful logging for debugging.

**What Gets Filtered:**
- Messages where `content` is `None`
- Messages with empty strings (`""`)
- Messages with only whitespace (`"   \n\t   "`)

**Contextual Logging:**
When a message is filtered, you'll see a warning with helpful context:

```
WARNING [SummaryAgent] Filtering out empty message at position 3. Previous message content starts with: '-------\nOriginal te...'
```

This tells you:
- **Which agent** filtered the message
- **Where** in the message list it occurred
- **Context** from the previous non-empty message

**Example:**

```python
class SummaryAgent(BaseAgent[SummaryInput, SummaryOutput]):
    async def prep_input(self, llm_input, ctx):
        messages = [
            {"role": "user", "content": f"Language: {ctx.language}"},
            {"role": "user", "content": ""},  # This gets filtered automatically
            {"role": "user", "content": f"Text: {ctx.content}"},
        ]
        return PrepareRun(llm_input=messages, context=ctx)

# Before: You had to manually filter
# messages = [m for m in messages if m.get("content", "").strip()]

# After: Filtering happens automatically in run_result()
```

**Customization:**

Need different filtering logic? Override `_filter_empty_messages`:

```python
class StrictFilterAgent(BaseAgent[MyContext, MyOutput]):
    def _filter_empty_messages(self, messages):
        """Custom filtering: also remove messages with only punctuation."""
        filtered = []
        for message in messages:
            content = message.get("content", "")
            if isinstance(content, str):
                stripped = content.strip()
                if stripped and not all(c in ".,!? \t\n" for c in stripped):
                    filtered.append(message)
            elif content:  # Non-string content (like file inputs)
                filtered.append(message)
        return filtered
```

**Migration Guide:**

- âœ… **No changes required** - filtering happens automatically
- ğŸ’¡ **Remove manual filtering** - If you were filtering empty messages in `prep_input`, you can now remove that code
- ğŸ“ **Check logs** - Review warnings to identify sources of empty messages in your workflows

---

### 3. File Loading Utility

**The Problem:**
Loading local files (PDFs, DOCX, text files) into agent inputs required boilerplate code for reading files, detecting MIME types, and converting formats.

**The Solution:**
New `load_file_to_content()` utility function that handles all file loading details:

```python
from antgent.utils.content import load_file_to_content

# Load any file type
content = load_file_to_content("document.pdf")
messages = await content.to_messages()

# With custom title
content = load_file_to_content("notes.txt", title="Meeting Notes")
messages = await content.to_messages(role="user")
```

**Supported File Types:**

| File Type | Extension | Handling |
|-----------|-----------|----------|
| Text files | `.txt`, `.md`, `.csv`, `.json`, `.yaml` | Decoded to UTF-8 strings |
| DOCX files | `.docx` | Text extracted and returned as string |
| Binary files | `.pdf`, images, etc. | Loaded as bytes with MIME type |

**Automatic MIME Detection:**
The utility automatically detects and sets the appropriate MIME type for each file.

**Use in Agents:**

```python
class DocumentAnalysisAgent(BaseAgent[AnalysisContext, AnalysisOutput]):
    async def prep_input(self, llm_input, ctx):
        messages = []
        
        # Load a local file
        if ctx.document_path:
            doc_content = load_file_to_content(ctx.document_path)
            messages.extend(await doc_content.to_messages())
        
        # Add instructions
        messages.append({
            "role": "user",
            "content": f"Analyze this document for {ctx.analysis_type}"
        })
        
        return PrepareRun(llm_input=messages, context=ctx)
```

**Complete Example:**

```python
from antgent.utils.content import load_file_to_content
from antgent.agents.base import BaseAgent

class MultiDocumentAgent(BaseAgent[MyContext, MyOutput]):
    async def prep_input(self, llm_input, ctx):
        messages = []
        
        # Load multiple files
        for file_path in ctx.file_paths:
            content = load_file_to_content(file_path)
            messages.extend(await content.to_messages())
        
        # Add comparison prompt
        messages.append({
            "role": "user",
            "content": "Compare these documents and summarize key differences."
        })
        
        return PrepareRun(llm_input=messages, context=ctx)
```

**Migration Guide:**

- âœ… **Optional feature** - only use if you need local file loading
- ğŸ’¡ **Import location**: `from antgent.utils.content import load_file_to_content`
- ğŸ“ **No breaking changes** - existing file handling code continues to work

---

## ğŸ—ï¸ Architectural Refactoring

In our pursuit of a cleaner, more modular codebase, we've undertaken a significant refactoring of core components. While we've made efforts to maintain backward compatibility for the most common imports, these changes are important for anyone building on or contributing to AntGent.

### `BaseAgent` Decomposition

The `antgent.agents.base.BaseAgent` class has been refactored to follow the Single Responsibility Principle. Its core functionalities have been extracted into dedicated mixins:

-   **Configuration Logic** -> `antgent.agents.config_resolver.ConfigResolverMixin`
-   **Execution Logic** -> `antgent.agents.runner.AgentRunnerMixin`
-   **Message Handling** -> `antgent.agents.message_handler.MessageHandlerMixin`

This change is internal to `BaseAgent` and should not affect standard agent implementations. If you have complex `BaseAgent` subclasses that override methods like `run_result` or `update_config`, please review the new structure.

### API Utility Module Split

The `antgent.server.api.utils` module has been decomposed. Its functions have been moved to more specific locations:

-   S3 file upload logic (`prep_contents`) is now in `antgent.services.s3_uploader`.
-   Workflow queue logic (`get_workflow_queue`) is now in `antgent.temporal.queue_manager`.

**Breaking Change for Importers:**

While `antgent.server.api.utils` still exports these functions for backward compatibility, this compatibility layer will be removed in a future version. We strongly recommend updating your imports to point to the new locations:

-   **Old:** `from antgent.server.api.utils import prep_contents`
-   **New:** `from antgent.services.s3_uploader import prep_contents`

-   **Old:** `from antgent.server.api.utils import get_workflow_queue`
-   **New:** `from antgent.temporal.queue_manager import get_workflow_queue`

### Deletion of `antgent/s3.py`

The file `antgent/s3.py`, which contained a re-export of `S3Client`, has been **deleted**. All S3 client instantiation is now handled by the `s3_client` factory function.

**Breaking Change for Importers:**

-   **Old:** `from antgent.s3 import S3Client`
-   **New:** `from antgent.clients import s3_client`

## ğŸ”„ Backwards Compatibility

All changes in v0.11.0 are **fully backwards compatible**:

- âœ… Existing configurations work without changes
- âœ… Manual provider settings still respected
- âœ… Current message handling unchanged
- âœ… No new required dependencies

## ğŸ“¦ Installation

Update to the latest version:

```bash
uv sync
# or
pip install --upgrade antgent
```

## ğŸ¯ Recommended Actions

1. **Review Configuration**: Audit your `localconfig.yaml` for repeated provider settings
2. **Consolidate Provider Settings**: Move provider-specific configs to `model_providers`
3. **Remove Redundant Code**: Clean up manual empty message filtering
4. **Simplify File Loading**: Consider using `load_file_to_content()` where applicable

## ğŸ› Bug Fixes & Improvements

- Reduced cyclomatic complexity in `BaseAgent.update_config()` through refactoring
- Fixed circular import issues in utility modules
- Added comprehensive logging for configuration resolution
- Improved type hints and documentation

## ğŸ“ Deprecation Notices

- `BaseWorkflowInput` is deprecated in favor of `WorkflowInput` (will be removed in v1.0.0)

## ğŸ™ Acknowledgments

Thanks to all contributors who provided feedback and helped shape these features!

## ğŸ“š Resources

- [Documentation](https://antgent.readthedocs.io/)
- [GitHub Repository](https://github.com/your-org/antgent)
- [Example Workflows](https://github.com/your-org/antgent/tree/main/examples)

---

Have questions or feedback? Open an issue on GitHub or join our community discussions!
